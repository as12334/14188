$(function(){var g=null;var h=$("div.goodList");var d=$("#divLoading");var b=60;var f=0;var c=$(".weixin-mask");var a={sortID:$("#hidSortID").val(),brandID:0,orderFlag:$("#hidOrderFlag").val(),FIdx:1,EIdx:b,isCount:1};var e=function(){var n=new $CartComm();var j=function(o){$.PageDialog('<div class="Prompt">'+o+"</div>",{W:150,H:45,close:false,autoClose:true,submit:function(){location.reload()}})};var k=function(o){$.PageDialog.fail(o)};var m=function(o){$.PageDialog.ok(o)};var i=function(v,p,q,o,x){var r=255;var u=126;if(typeof(o)!="undefined"){r=o}if(typeof(o)!="undefined"){u=x}var w=null;var y='<div class="clearfix m-round u-tipsEject"><div class="u-tips-txt">'+v+'</div><div class="u-Btn"><div class="u-Btn-li"><a href="javascript:;" id="btnMsgCancel" class="z-CloseBtn">取消</a></div><div class="u-Btn-li"><a id="btnMsgOK" href="javascript:;" class="z-DefineBtn">确定</a></div></div></div>';var t=function(){var z=$("#pageDialog");z.find("a.z-DefineBtn").click(function(){if(typeof(p)!="undefined"&&p!=null){p()}s.close()});z.find("a.z-CloseBtn").click(function(){if(typeof(q)!="undefined"&&q!=null){q()}s.cancel()})};var s=new $.PageDialog(y,{W:r,H:u,close:true,autoClose:false,ready:t})};var l=function(){var t=function(){return"sortID="+a.sortID+"&brandID="+a.brandID+"&orderFlag="+a.orderFlag+"&FIdx="+a.FIdx+"&EIdx="+a.EIdx+"&isCount="+a.isCount};var o=false;var s=false;var r=function(x,w){c.bind("click",function(){$(this).hide();if(o){x.next("div").hide();x.find("cite").remove();_IsLoading=false;o=false;$("body").attr("style","");IsMasked=false}else{if(s){w.next("div").hide();w.find("cite").remove();_IsLoading=false;s=false;$("body").attr("style","");IsMasked=false}}});x.bind("click",function(z){stopBubble(z);var y=$(this).next("div");if(o){y.hide();$(this).find("cite").remove();c.hide();_IsLoading=false;$("body").attr("style","");IsMasked=false;o=false;return}if(x.find("cite").length==0){x.append("<cite><em></em></cite>")}w.find("cite").remove();y.show().siblings("div").hide();c.height($(document).height()).show();_IsLoading=true;$("body").attr("style","overflow:hidden;");IsMasked=true;s=false;o=true});w.bind("click",function(y){stopBubble(y);q(x,w)})};var q=function(y,x){if(x.html().indexOf("#bbbbbb")>-1){return}var w=x.next("div");if(s){w.hide();$(this).find("cite").remove();c.hide();_IsLoading=false;$("body").attr("style","");IsMasked=false;s=false;return}if(x.find("cite").length==0){x.append("<cite><em></em></cite>")}y.find("cite").remove();w.show().siblings("div").hide();c.height($(document).height()).show();_IsLoading=true;$("body").attr("style","overflow:hidden;");IsMasked=true;o=false;s=true};var p=function(z,w){var x=$(z).next("div");var y=$(w).next("div");x.children("a").each(function(){var A=$(this);A.bind("click",function(C){stopBubble(C);a.sortID=A.attr("type");a.orderFlag=10;w.html('即将揭晓<span></span><b class="fl"></b>');var B=w.next("div.sort_list").find("li:first").find("a");B.addClass("hover").parent().siblings("li").find("a").removeClass("hover");if(a.sortID==400){w.html('<font color="#bbbbbb">最新</font>')}A.addClass("hover").siblings().removeClass("hover");x.hide();z.html(A.html()+'<span></span><b class="fr"></b>');o=false;c.hide();_IsLoading=false;$("body").attr("style","");IsMasked=false;g.getInitPage()})});y.find("ul li").each(function(){var A=$(this);A.bind("click",function(D){stopBubble(D);a.orderFlag=A.attr("order");var B=A.find("a");B.addClass("hover").parent().siblings("li").find("a").removeClass("hover");y.hide();if(a.orderFlag=="31"){A.attr("class","down").attr("order","30");w.html('价值(由低到高)<span></span><b class="fl"></b>')}else{if(a.orderFlag=="30"){A.attr("class","up").attr("order","31");w.html('价值(由高到低)<span></span><b class="fl"></b>')}else{var C=B.html().replace("<s></s>","").replace("<i></i>","");w.html(C+'<span></span><b class="fl"></b>')}}s=false;c.hide();_IsLoading=false;$("body").attr("style","");IsMasked=false;g.getInitPage()})})};var u=function(y,x,w){y.addClass("add");n.addShopCart(x,w,function(z){if(z.code==0){addNumToCartFun(z.num);m("添加成功")}else{if(z.code==1){if(z.num==0){j("啊哦~！被抢光啦！")}else{var D=y.parent().parent();var B=z.str;if(B!=""){var F=B.split("|");if(F!=null&&F.length==6){var C=function(){y.attr("codeid",F[0]);D.find("h3.gray6").find("em").html(F[1]);D.find("em.gray9").html("价值：￥"+CastMoney(F[3]));D.find("span.pgbar").attr("style","width:"+F[5]+"%");D.find(".P-bar01").find("em").html(F[2]);D.find(".P-bar02").find("em").html(F[3]);D.find(".P-bar03").find("em").html(F[4])};var A=function(){C();u(y,F[0],w)};var E=function(){C()};i("本云已满员，是否云购下一云？",A,E)}}else{k("本商品已结束");D.find("span.pgbar").attr("style","width:100%");D.find(".P-bar01").find("em").html(D.find(".P-bar02").find("em").html());D.find(".P-bar03").find("em").html("0")}}}else{if(z.code==2){k("哎呀！购物车满啦，删除一些吧！",300)}else{if(z.code==3){k("您参与人次已达上限！")}else{k("添加失败，请重试["+z.code+"]")}}}}y.removeClass("add")})};var v=function(){GetJPData("","getGoodsPageList",t(),function(A){if(A.code==0){var z=A.listItems;if(a.isCount==1){f=A.count;a.isCount=0}var C=z.length;var D=0;var F=0;var w=0;var G=0;for(var B=0;B<C;B++){var y=z[B];D=parseInt(y.codeSales);F=parseInt(y.codeQuantity);w=parseInt(F-D);G=parseInt(D*100)/F;G=D>0&&G<1?1:G;var x="";x+='<ul id="'+y.goodsID+'">';x+="<li>";x+='<span class="gList_l fl">';x+='<img src="'+Gobal.LoadPic+'" src2="http://mimg.1yyg.com/GoodsPic/pic-200-200/'+y.goodsPic+'" />';if(y.goodsTag==10){x+='<div class="pTitle pPurchase">限购</div>'}x+="</span>";x+='<div class="gList_r">';x+='<h3 class="gray6">(第<em>'+y.codePeriod+"</em>云)"+y.goodsSName+"</h3>";x+='<em class="gray9">价值：￥'+CastMoney(y.codePrice);x+="</em>";x+='<div class="gRate">';x+='<div class="Progress-bar">';x+='<p class="u-progress"><span style="width: '+G+'%;" class="pgbar"><span class="pging"></span></span></p>';x+='<ul class="Pro-bar-li">';x+='<li class="P-bar01"><em>'+D+"</em>已参与</li>";x+='<li class="P-bar02"><em>'+F+"</em>总需人次</li>";x+='<li class="P-bar03"><em>'+w+"</em>剩余</li>";x+="</ul>";x+="</div>";if(w==0){x+='<a href="javascript:" codeid="'+y.codeID+'" class="unAdd"><s></s></a></div>'}else{x+='<a href="javascript:" codeid="'+y.codeID+'" ><s></s></a></div>'}x+="</div>";x+="</li>";x+="</ul>";var E=$(x);E.click(function(){location.href="/"+Gobal.SiteVer+"/products/"+$(this).attr("id")+".do"}).find("div.gRate").find("a").each(function(){var H=$(this);H.click(function(I){stopBubble(I);if(!H.hasClass("unAdd")){u(H,H.attr("codeid"),1)}})});h.append(E)}if(a.EIdx<f){_IsLoading=false}else{_IsLoading=true;d.hide()}loadImgFun(0)}else{if(A.code==-1){if(a.FIdx==1){_IsLoading=true;h.html(Gobal.NoneHtml)}d.hide()}else{k("加载失败，请重试["+A.code+"]！")}}})};this.BindSortOrder=function(){var y=$(".column").children("a");var w=$(y.get(0));var x=$(y.get(1));r(w,x);p(w,x)};this.getInitPage=function(){a.FIdx=1;a.EIdx=b;a.isCount=1;f=0;h.empty();v()};this.getFirstPage=function(){v()};this.getNextPage=function(){a.FIdx+=b;a.EIdx+=b;v()}};g=new l();g.BindSortOrder();g.getFirstPage();scrollForLoadData(g.getNextPage)};Base.getScript(Gobal.Skin+"/JS/pageDialog.js?v=160304",function(){Base.getScript(Gobal.Skin+"/JS/CartComm.js?v=160523",e)})});